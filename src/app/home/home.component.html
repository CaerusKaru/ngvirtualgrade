<div fxFill fxLayout="column">
  <div class="nav-bar" fxLayout="row">
    <nav md-tab-nav-bar fxFlex>
      <div *ngIf="!isSideBySide">
        <button md-icon-button (click)="sidenav.toggle()" fxFlexOffset="10px" title="Show nav menu">
          <md-icon>menu</md-icon>
        </button>
      </div>
      <span fxLayoutAlign="space-around center" fxFlexOffset="30px">
        <a routerLink=""
           (click)="activeLinkIndex = 0">
          <img src="../assets/logo.png"
               alt="logo for virtual grade"
               height="13"
               width="93.5"
               fxLayoutAlign="center center" />
        </a>
      </span>
      <span fxFlex="30px"></span>
      <div *ngFor="let link of navLinks; let i = index" fxLayoutAlign="center center">
        <a md-tab-link
           *ngIf="isSideBySide && link.show"
           [routerLink]="link.route"
           [active]="activeLinkIndex === i"
           (click)="activeLinkIndex = i">
          <span fxFill fxLayoutAlign="center center">{{link.label}}</span>
        </a>
      </div>
      <span fxFlex></span>
      <md-menu #appMenu="mdMenu" y-position="below" [overlapTrigger]="false">
        <button md-menu-item (click)="logOut()"> Log Out </button>
      </md-menu>

      <button md-button [mdMenuTriggerFor]="appMenu" *ngIf="utln$ | async as utln; else signin">
        {{utln}}
      </button>

      <ng-template #signin>
        <button md-button (click)="logIn()">Sign In</button>
      </ng-template>
    </nav>
  </div>
  <md-sidenav-container fxFlex>
    <md-sidenav #sidenav
                class="dark-theme"
                [mode]="isSideBySide ? 'side' : 'over'"
                [opened]="isSideBySide || isOpen">
      <nav-menu-container fxFlex class="mat-app-background">
        <nav-menu-header label="Courses" *ngIf="courses$ | async as courses">
          <nav-menu-toggle *ngFor="let course of courses | sortBy: ''"
                           label="{{course['name']}}">
            <nav-menu-link link="{{mode}}/{{course['name']}}">
              Home
            </nav-menu-link>
            <nav-menu-link *ngFor="let link of course['assigns'] | sort"
                           link="{{mode}}/{{course['name']}}/{{link}}">
              {{link}}
            </nav-menu-link>
          </nav-menu-toggle>
        </nav-menu-header>
        <nav-menu-header label="Inactive Courses" *ngIf="inCourses$ | async as courses">
          <nav-menu-toggle *ngFor="let course of courses | sortBy: ''"
                           label="{{course['name']}}">
            <nav-menu-link link="{{mode}}/{{course['name']}}">
              Home
            </nav-menu-link>
            <nav-menu-link *ngFor="let link of course['assigns'] | sort"
                           link="{{mode}}/{{course['name']}}/{{link}}">
              {{link}}
            </nav-menu-link>
          </nav-menu-toggle>
        </nav-menu-header>
        <nav-menu-header label="Pages" *ngIf="!courses$">
          <nav-menu-link link="/" *ngIf="isSideBySide">Home</nav-menu-link>
          <nav-menu-link link="/about">About</nav-menu-link>
          <nav-menu-link link="/help">Help</nav-menu-link>
        </nav-menu-header>
        <div *ngFor="let link of navLinks">
          <nav-menu-link [link]="link.route" *ngIf="!isSideBySide && link.show">{{link.label}}</nav-menu-link>
        </div>
      </nav-menu-container>
    </md-sidenav>
    <div [@routeAnimation]="prepRouteState(routerOutlet)">
      <div class="router-container">
        <router-outlet #routerOutlet="outlet"></router-outlet>
      </div>
    </div>
  </md-sidenav-container>
</div>

